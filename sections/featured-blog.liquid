{% schema %}
{
  "name": "Blog Post",
  "settings": [
    {
      "type": "blog",
      "id": "blog",
      "label": "Select Blog"
    },
    {
      "type": "number",
      "id": "post_limit",
      "label": "Number of Posts to Display",
      "default": 8
    }
  ],
  "presets": [
    {
      "name": "Blog Post",
      "category": "Blog"
    }
  ]
}
{% endschema %}

<link rel="stylesheet" href="{{ 'blog-slider.css' | asset_url }}">

<div class="blog-slider-section">
    <div class="arrow-buttons">
        <button class="arrow arrow-left" onclick="moveSlide(-1)">‹</button>
        <button class="arrow arrow-right" onclick="moveSlide(1)">›</button>
    </div>
    
    <div class="slider-container">
        <div class="slider-wrapper" id="sliderWrapper">
            {% assign blog_handle = section.settings.blog %}
            {% assign post_limit = section.settings.post_limit %}
            {% for article in blogs[blog_handle].articles limit: post_limit %}
            <div class="card">
                {% if article.image %}
                    <img src="{{ article.image | img_url: '450x300', crop: 'center' }}" alt="{{ article.title }}">
                {% else %}
                    <img src="{{ 'default-image.jpg' | asset_url }}" alt="Default Image">
                {% endif %}
                <div class="card-content">
                    <h3 class="card-title">{{ article.title | escape }}</h3>
                    <a href="{{ article.url }}" class="read-more-btn">
                        Read more
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        let currentSlide = 0;
        const sliderWrapper = document.getElementById('sliderWrapper');
        const cards = sliderWrapper.querySelectorAll('.card');
        const totalSlides = cards.length;
        const visibleSlides = 4;
        const leftArrow = document.querySelector('.arrow-left');
        const rightArrow = document.querySelector('.arrow-right');

        const cardWidth = cards[0].offsetWidth;
        const gap = 20;
        const slideWidth = cardWidth + gap;

        function updateArrowState() {
            leftArrow.disabled = currentSlide === 0;
            rightArrow.disabled = currentSlide >= totalSlides - visibleSlides;
        }

        window.moveSlide = function(direction) {
            const newSlide = currentSlide + direction;
            
            if (newSlide >= 0 && newSlide <= totalSlides - visibleSlides) {
                currentSlide = newSlide;
                const offset = -currentSlide * slideWidth;
                sliderWrapper.style.transform = `translateX(${offset}px)`;
                updateArrowState();
            }
        }


        updateArrowState();

        window.addEventListener('resize', function() {
            const offset = -currentSlide * slideWidth;
            sliderWrapper.style.transform = `translateX(${offset}px)`;
        });
    });
</script>
