<link rel="stylesheet" href="{{ 'popup.css' | asset_url }}">

{% if section.settings.layout_style == 'layout1' %}
  <div class="popup-overlay" id="popupOverlay">
    <div class="popup color-{{ section.settings.color_scheme }}">
      <div class="popup-test">
        <svg
          class="pop_svg"
          width="441"
          height="325"
          viewBox="0 0 441 325"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path fill-rule="evenodd" clip-rule="evenodd" d="M374.397 0H345.337C345.768 1.42416 346 2.93499 346 4.5C346 13.0604 339.06 20 330.5 20C321.94 20 315 13.0604 315 4.5C315 2.93499 315.232 1.42416 315.663 0H287.603C287.863 1.12477 288 2.29636 288 3.5C288 12.0604 281.06 19 272.5 19C263.94 19 257 12.0604 257 3.5C257 2.29636 257.137 1.12477 257.397 0H228.337L228.355 0.0625027C228.775 1.46834 229 2.95787 229 4.5C229 13.0604 222.06 20 213.5 20C204.94 20 198 13.0604 198 4.5C198 3.02868 198.205 1.60524 198.588 0.256685C198.612 0.170818 198.637 0.0852527 198.663 0H170.337C170.768 1.42416 171 2.93499 171 4.5C171 13.0604 164.06 20 155.5 20C146.94 20 140 13.0604 140 4.5C140 2.93499 140.232 1.42416 140.663 0H113.603C113.863 1.12477 114 2.29636 114 3.5C114 12.0604 107.06 19 98.5 19C89.9396 19 83 12.0604 83 3.5C83 2.29636 83.1372 1.12477 83.3968 0H58.6032C58.8628 1.12477 59 2.29636 59 3.5C59 12.0604 52.0604 19 43.5 19C34.9396 19 28 12.0604 28 3.5C28 2.29636 28.1372 1.12477 28.3968 0H4C1.79086 0 0 1.79086 0 4V33.6633C1.42416 33.2319 2.93499 33 4.5 33C13.0604 33 20 39.9396 20 48.5C20 57.0604 13.0604 64 4.5 64C2.93499 64 1.42416 63.7681 0 63.3367V88.6633C1.42416 88.2319 2.93499 88 4.5 88C13.0604 88 20 94.9396 20 103.5C20 112.06 13.0604 119 4.5 119C2.93499 119 1.42416 118.768 0 118.337V145.397C1.12477 145.137 2.29636 145 3.5 145C12.0604 145 19 151.94 19 160.5C19 169.06 12.0604 176 3.5 176C2.29636 176 1.12477 175.863 0 175.603V203.397C1.12477 203.137 2.29636 203 3.5 203C12.0604 203 19 209.94 19 218.5C19 227.06 12.0604 234 3.5 234C2.29636 234 1.12477 233.863 0 233.603V262.663C1.42416 262.232 2.93499 262 4.5 262C13.0604 262 20 268.94 20 277.5C20 286.06 13.0604 293 4.5 293C2.93499 293 1.42416 292.768 0 292.337V321C0 323.209 1.79085 325 3.99999 325H31.3968C31.1372 323.875 31 322.704 31 321.5C31 312.94 37.9396 306 46.5 306C55.0604 306 62 312.94 62 321.5C62 322.704 61.8628 323.875 61.6032 325H86.3968C86.1372 323.875 86 322.704 86 321.5C86 312.94 92.9396 306 101.5 306C110.06 306 117 312.94 117 321.5C117 322.704 116.863 323.875 116.603 325H143.201C143.069 324.186 143 323.351 143 322.5C143 313.94 149.94 307 158.5 307C167.06 307 174 313.94 174 322.5C174 323.351 173.931 324.186 173.799 325H201.201C201.069 324.186 201 323.351 201 322.5C201 313.94 207.94 307 216.5 307C225.06 307 232 313.94 232 322.5C232 323.351 231.931 324.186 231.799 325H260.397C260.137 323.875 260 322.704 260 321.5C260 312.94 266.94 306 275.5 306C284.06 306 291 312.94 291 321.5C291 322.704 290.863 323.875 290.603 325H318.201C318.069 324.186 318 323.351 318 322.5C318 313.94 324.94 307 333.5 307C342.06 307 349 313.94 349 322.5C349 323.351 348.931 324.186 348.799 325H377.397C377.137 323.875 377 322.704 377 321.5C377 312.94 383.94 306 392.5 306C401.06 306 408 312.94 408 321.5C408 322.704 407.863 323.875 407.603 325H437C439.209 325 441 323.209 441 321V292.337C439.576 292.768 438.065 293 436.5 293C427.94 293 421 286.06 421 277.5C421 268.94 427.94 262 436.5 262C438.065 262 439.576 262.232 441 262.663V232.996C439.291 233.645 437.437 234 435.5 234C426.94 234 420 227.06 420 218.5C420 209.94 426.94 203 435.5 203C437.437 203 439.291 203.355 441 204.004V174.996C439.291 175.645 437.437 176 435.5 176C426.94 176 420 169.06 420 160.5C420 151.94 426.94 145 435.5 145C437.437 145 439.291 145.355 441 146.004V118.337C439.576 118.768 438.065 119 436.5 119C427.94 119 421 112.06 421 103.5C421 94.9396 427.94 88 436.5 88C438.065 88 439.576 88.2319 441 88.6633V63.3367C439.576 63.7681 438.065 64 436.5 64C427.94 64 421 57.0604 421 48.5C421 39.9396 427.94 33 436.5 33C438.065 33 439.576 33.2319 441 33.6633V4C441 1.79086 439.209 0 437 0H404.603C404.863 1.12477 405 2.29636 405 3.5C405 12.0604 398.06 19 389.5 19C380.94 19 374 12.0604 374 3.5C374 2.29636 374.137 1.12477 374.397 0Z" fill="currentColor"/>
        </svg>
        <div class="popup-header">
          <div class="popup-header-background">
            <div class="popup_heading">{{ section.settings.popup_title }}</div>
            <button id="closePopup">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20">
                <path fill-rule="evenodd" d="M10 9.293l4.646-4.646a1 1 0 011.414 1.414L11.414 10l4.646 4.646a1 1 0 01-1.414 1.414L10 11.414l-4.646 4.646a1 1 0 01-1.414-1.414L8.586 10 3.94 5.354A1 1 0 015.354 3.94L10 9.293z" clip-rule="evenodd"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="popup-message">
          {{ section.settings.popup_message | richtext }}
        </div>
        <div class="popup-input-wrapper">
          <img src="{{ 'mail.png' | asset_url }}" alt="Icon Description" class="popup-email-icon">
          <input
            type="email"
            id="emailInput"
            class="popup-email-input"
            placeholder="{{ section.settings.email_placeholder }}"
          >
        </div>

        <button class="popup-subscribe-btn" onclick="handleSubscribe()">{{ section.settings.button_text }}</button>
      </div>
    </div>
  </div>
{% else %}
  <div class="popup-box color-{{ section.settings.color_scheme }}" id="popup-box">
    <div class="popup-heading-container-layout2">
      <div class="popup-heading-layout2">{{ section.settings.popup_title }}</div>
      <div id="closePopupbox" class="popup-close-btn">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 20 20"
          fill="currentColor"
          width="28"
          height="28"
        >
          <path fill-rule="evenodd" d="M10 9.293l4.646-4.646a1 1 0 011.414 1.414L11.414 10l4.646 4.646a1 1 0 01-1.414 1.414L10 11.414l-4.646 4.646a1 1 0 01-1.414-1.414L8.586 10 3.94 5.354A1 1 0 015.354 3.94L10 9.293z" clip-rule="evenodd"/>
        </svg>
      </div>
    </div>
    <div class="popup-message-layout2">
      {{ section.settings.popup_message | richtext }}
    </div>

    <form id="popupForm" class="popup-form">
      <div class='emailkadabba'> 
      <img src="{{ 'mail.png' | asset_url }}" alt="Icon Description" class="emailkaicon">
      <input
        type="email"
        id="emailInputLayout2"
        class="popup-email-input-layout2"
        placeholder="{{ section.settings.email_placeholder }}"
      >
      </div> 
      <button class="popup-subscribe-btn" onclick="handleSubscribe()">{{ section.settings.button_text }}</button>
    </form>
  </div>
{% endif %}

<script>
  // function to validate email
  function validateEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // Email validation regex
    return emailRegex.test(email);
  }

  // subscription logic
  function handleSubscribe(layout) {
    const emailInputId = layout === 'layout1' ? 'emailInput' : 'emailInputLayout2';
    const emailInput = document.getElementById(emailInputId).value.trim();

    if (!emailInput) {
      alert("{{ section.settings.empty_email_message }}");
      return;
    }

    if (!validateEmail(emailInput)) {
      alert("{{ section.settings.invalid_email_message }}");
      return;
    }

    alert("{{ section.settings.success_message }}");
    document.getElementById('popupOverlay').style.display = 'none';
  }

  // Close popup when the close button is clicked
  document.querySelectorAll('#closePopup').forEach((closeButton) => {
    closeButton.addEventListener('click', function () {
      document.getElementById('popupOverlay').style.display = 'none';
    });
  });

  // Close popup when the close button is cliscked for layout 2
  document.querySelectorAll('#closePopupbox').forEach((closeButton) => {
    closeButton.addEventListener('click', function () {
      document.getElementById('popup-box').style.display = 'none';
    });
  });

  // subscribe buttons event listners
  document.querySelectorAll('.popup-subscribe-btn').forEach((button) => {
    button.addEventListener('click', function () {
      const layout = button.closest('.popup').classList.contains('popup-overlay-layout2') ? 'layout2' : 'layout1';
      handleSubscribe(layout);
    });
  });
</script>

{% schema %}
{
  "name": "Popup",
  "settings": [

     {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "select",
      "id": "layout_style",
      "label": "Choose Layout",
      "options": [
        {
          "value": "layout1",
          "label": "Layout 1"
        },
        {
          "value": "layout2",
          "label": "Layout 2"
        }
      ],
      "default": "layout2"
    },
    {
      "type": "text",
      "id": "popup_title",
      "label": "Popup Title",
      "default": "Join Our Communiy!"
    },
    {
      "type": "richtext",
      "id": "popup_message",
      "label": "Popup Message",
      "default": "<p>Stay updated with the latest news, exclusive offers, and expert tips. Sign up for our newsletter and get 10% off your first order!</p>"
    },
    {
      "type": "text",
      "id": "email_placeholder",
      "label": "Email Placeholder Text",
      "default": "Enter your email address"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Subscribe"
    },
    {
      "type": "text",
      "id": "empty_email_message",
      "label": "Empty Email Error Message",
      "default": "Please enter an email address."
    },
    {
      "type": "text",
      "id": "invalid_email_message",
      "label": "Invalid Email Error Message",
      "default": "Please enter a valid email address."
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Success Message",
      "default": "Thank you for subscribing!"
    }
  ],
  "blocks": [],
  "presets": [
    {
      "name": "Popup",
      "category": "Popups"
    }
  ]
}
{% endschema %}
