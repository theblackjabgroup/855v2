name: Shopify Lighthouse CI

on: [push]

jobs:
  lhci:
    name: Lighthouse (PF_TESTING)
    runs-on: ubuntu-latest
    steps:
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "20"

      - name: Install Shopify CLI
        run: |
          npm install -g @shopify/cli @shopify/theme
          echo "SHOPIFY_FLAG_STORE=theme-blackbytt-poc.myshopify.com" >> $GITHUB_ENV

      - uses: actions/checkout@v2

      - name: Lighthouse
        uses: shopify/lighthouse-ci-action@v1
        with:
          access_token: "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"
          store: "theme-blackbytt-poc.myshopify.com"
          lhci_min_score_accessibility: 0.9
          lhci_min_score_performance: 0.7
          password: "saylyo"

      - name: Clearing Theme Stack
        run: |
          chmod +x ./dev-deletion.sh  
          ./dev-deletion.sh

        # ------------------------To be implemented-----------------------------
        # access_token: ${{ secrets.SHOP_ACCESS_TOKEN }}
        # store: ${{ secrets.SHOP_STORE }}
        # password: ${{ secrets.SHOP_PASSWORD }}
        # lhci_min_score_accessibility: .9
        # lhci_github_app_token: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}
